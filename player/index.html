<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>No Label Player</title>
  <!-- Tailwind CDN for quick Scandinavian‑meets‑J‑card styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* fine black rules + manual progress styling */
    .active{background:#000;color:#fff}
    progress{width:100%;height:6px;appearance:none;border:1px solid #000;background:transparent}
    progress::-webkit-progress-bar{background:transparent}
    progress::-webkit-progress-value{background:#000}
    progress::-moz-progress-bar{background:#000}
  </style>
</head>
<body class="bg-amber-50 min-h-screen flex flex-col items-center p-8 font-sans text-[0.9rem] leading-tight tracking-tight">
  <h1 class="text-lg font-bold uppercase tracking-wide mb-6">No Label Player</h1>

  <div id="player" class="w-full max-w-lg bg-white border border-black p-6 shadow-sm">
    <div id="browseNav" class="flex justify-center space-x-4 mb-4">
      <button data-target="albums" class="px-2 py-1 border border-black active">Albums</button>
      <button data-target="artists" class="px-2 py-1 border border-black">Artists</button>
      <button data-target="playlists" class="px-2 py-1 border border-black">Playlists</button>
    </div>
    <!-- lists -->
    <ul id="albumList" class="album-list mb-4 max-h-40 overflow-y-auto divide-y divide-black"></ul>
    <ul id="artistList" class="artist-list mb-4 max-h-40 overflow-y-auto divide-y divide-black hidden"></ul>
    <ul id="playlistList" class="playlist-list mb-4 max-h-40 overflow-y-auto divide-y divide-black hidden"></ul>
    <img id="coverImg" alt="Album cover" class="w-full mb-4 hidden" />
    <ul id="trackList" class="track-list max-h-56 overflow-y-auto divide-y divide-black"></ul>

    <!-- controls -->
    <div class="controls flex justify-center space-x-8 mt-4 mb-3">
      <button id="prevBtn" aria-label="Previous track" class="p-1 hover:bg-black hover:text-white transition">Prev</button>
      <button id="playPauseBtn" aria-label="Play / Pause" class="p-1 hover:bg-black hover:text-white transition">Play</button>
      <button id="nextBtn" aria-label="Next track" class="p-1 hover:bg-black hover:text-white transition">Next</button>
    </div>
    <div id="nowPlaying" class="text-center mb-2"></div>
    <progress id="seekBar" value="0" max="100" aria-label="Playback position"></progress>
    <audio id="audio"></audio>
  </div>

  <script>
    /* =========================================================
      Load catalog.json generated by build script.
      The file should be available next to index.html
      (copy build/catalog.json there during deploy)
    ========================================================= */
    let albums = [];
    let playlists = [];
    let artists = [];

    fetch('catalog.json')
      .then(r => {
        if (!r.ok) throw new Error('catalog.json not found');
        return r.json();
      })
      .then(data => {
        albums = data.albums || [];
        playlists = data.playlists || [];
        artists = data.artists || [];
        boot();
      })
      .catch(err => {
        console.error(err);
        // graceful fallback – empty lists, show message
        document.getElementById('albumList').innerHTML = '<li class="px-2 py-2 text-red-600">catalog.json missing</li>';
      });

    /* =========================================================
       DOM refs
    ========================================================= */
    const albumListEl = document.getElementById("albumList");
    const artistListEl = document.getElementById("artistList");
    const playlistListEl = document.getElementById("playlistList");
    const navBtns = document.querySelectorAll('#browseNav button');
    const trackListEl = document.getElementById("trackList");
    const audioEl = document.getElementById("audio");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const seekBar = document.getElementById("seekBar");
    const coverImg = document.getElementById("coverImg");
    const nowPlayingEl = document.getElementById("nowPlaying");

    /* =========================================================
       State
    ========================================================= */
    let currentList = [];
    let currentIndex = 0;
    let isPlaying = false;

    navBtns.forEach(btn => {
      btn.onclick = () => {
        navBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.target;
        albumListEl.classList.toggle('hidden', target !== 'albums');
        artistListEl.classList.toggle('hidden', target !== 'artists');
        playlistListEl.classList.toggle('hidden', target !== 'playlists');
      };
    });

    /* =========================================================
       Render helpers
    ========================================================= */
    function renderAlbums() {
      albumListEl.innerHTML = '';
      albums.forEach((album, idx) => {
        const li = document.createElement("li");
        li.textContent = album.title;
        li.className = "px-2 py-2 cursor-pointer hover:bg-black/5";
        li.onclick = () => loadAlbum(idx);
        albumListEl.appendChild(li);
      });
    }

    function renderArtists() {
      artistListEl.innerHTML = '';
      artists.forEach((artist, idx) => {
        const li = document.createElement('li');
        li.textContent = artist.name;
        li.className = 'px-2 py-2 cursor-pointer hover:bg-black/5';
        li.onclick = () => loadArtist(idx);
        artistListEl.appendChild(li);
      });
    }

    function renderPlaylists() {
      playlistListEl.innerHTML = '';
      playlists.forEach((pl, idx) => {
        const li = document.createElement("li");
        li.textContent = pl.title;
        li.className = "px-2 py-2 cursor-pointer hover:bg-black/5";
        li.onclick = () => loadPlaylist(idx);
        playlistListEl.appendChild(li);
      });
    }

    function loadAlbum(i) {
      currentList = albums[i].tracks;
      highlight(albumListEl, i);
      highlight(artistListEl, -1);
      highlight(playlistListEl, -1);
      if (albums[i].cover) {
        coverImg.src = albums[i].cover;
        coverImg.classList.remove('hidden');
      } else {
        coverImg.classList.add('hidden');
      }
      trackListEl.scrollTop = 0;
      renderTrackList();
      loadTrack(0);
    }

    function loadArtist(i) {
      currentList = artists[i].tracks;
      highlight(artistListEl, i);
      highlight(albumListEl, -1);
      highlight(playlistListEl, -1);
      coverImg.classList.add('hidden');
      trackListEl.scrollTop = 0;
      renderTrackList();
      loadTrack(0);
    }

    function loadPlaylist(i) {
      currentList = playlists[i].tracks;
      highlight(playlistListEl, i);
      highlight(albumListEl, -1);
      highlight(artistListEl, -1);
      coverImg.classList.add('hidden');
      trackListEl.scrollTop = 0;
      renderTrackList();
      loadTrack(0);
    }

    function renderTrackList() {
      trackListEl.innerHTML = "";
      currentList.forEach((t, idx) => {
        const li = document.createElement("li");
        li.textContent = `${t.title} – ${t.artist}`;
        li.className = "px-2 py-2 cursor-pointer hover:bg-black/5";
        li.onclick = () => loadTrack(idx);
        trackListEl.appendChild(li);
      });
    }

    function loadTrack(i) {
      currentIndex = i;
      const track = currentList[i];
      if (!track) return;
      audioEl.src = track.src;
      highlight(trackListEl, i);
      nowPlayingEl.textContent = `${track.title} – ${track.artist} (${track.album})`;
      if (isPlaying) audioEl.play();
    }

    function highlight(listEl, idx) {
      Array.from(listEl.children).forEach((li, i) => {
        li.classList.toggle("active", i === idx);
      });
    }

    /* =========================================================
       Controls
    ========================================================= */
    playPauseBtn.onclick = () => {
      if (!audioEl.src) return;
      isPlaying ? audioEl.pause() : audioEl.play();
    };
    prevBtn.onclick = () => currentIndex > 0 && loadTrack(currentIndex - 1);
    nextBtn.onclick = () => currentIndex < currentList.length - 1 && loadTrack(currentIndex + 1);

    audioEl.onplay = () => { isPlaying = true; playPauseBtn.textContent = "Pause"; };
    audioEl.onpause = () => { isPlaying = false; playPauseBtn.textContent = "Play"; };
    audioEl.ontimeupdate = () => { seekBar.value = (audioEl.currentTime / audioEl.duration) * 100 || 0; };
    audioEl.onended = () => nextBtn.click();

    seekBar.onclick = (e) => {
      const rect = seekBar.getBoundingClientRect();
      audioEl.currentTime = ((e.clientX - rect.left) / rect.width) * audioEl.duration;
    };

    /* =========================================================
       Boot – called after catalog loads
    ========================================================= */
    function boot() {
      renderArtists();
      renderAlbums();
      renderPlaylists();
      if (albums.length) loadAlbum(0);
    }
  </script>
</body>
</html>
