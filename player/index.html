<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>No Label Player</title>
  <!-- Tailwind CDN for quick Scandinavian‑meets‑J‑card styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* fine black rules + manual progress styling */
    .active{background:#000;color:#fff}
    progress{width:100%;height:6px;appearance:none;border:1px solid #000;background:transparent}
    progress::-webkit-progress-bar{background:transparent}
    progress::-webkit-progress-value{background:#000}
    progress::-moz-progress-bar{background:#000}
  </style>
</head>
<body class="bg-amber-50 min-h-screen flex flex-col items-center p-8 font-sans text-[0.9rem] leading-tight tracking-tight">
  <h1 id="playerName" class="text-lg font-bold uppercase tracking-wide mb-6">No Label Player</h1>

  <div id="player" class="w-full max-w-lg md:max-w-2xl bg-white border border-black p-6 shadow-sm md:flex md:space-x-6">
    <div id="catalogNav" class="md:w-1/2">
      <div id="browseNav" class="flex justify-center space-x-4 mb-4">
        <button data-target="albums" class="px-2 py-1 border border-black active">Albums</button>
        <button data-target="artists" class="px-2 py-1 border border-black">Artists</button>
        <button data-target="playlists" class="px-2 py-1 border border-black">Playlists</button>
      </div>
      <ul id="albumList" class="album-list mb-4 max-h-40 overflow-y-auto divide-y divide-black"></ul>
      <ul id="artistList" class="artist-list mb-4 max-h-40 overflow-y-auto divide-y divide-black hidden"></ul>
      <ul id="playlistList" class="playlist-list mb-4 max-h-40 overflow-y-auto divide-y divide-black hidden"></ul>
    </div>
    <div id="nowPlayingSection" class="md:w-1/2 mt-6 md:mt-0">
      <img id="coverImg" alt="Album cover" class="w-full mb-4 hidden" />
      <ul id="trackList" class="track-list max-h-56 overflow-y-auto divide-y divide-black"></ul>
      <div class="controls flex justify-center space-x-8 mt-4 mb-3">
        <button id="prevBtn" aria-label="Previous track" class="p-1 hover:bg-black hover:text-white transition"></button>
        <button id="playPauseBtn" aria-label="Play / Pause" class="p-1 hover:bg-black hover:text-white transition"></button>
        <button id="nextBtn" aria-label="Next track" class="p-1 hover:bg-black hover:text-white transition"></button>
      </div>
      <div id="nowPlaying" class="text-center mb-2"></div>
      <progress id="seekBar" value="0" max="100" aria-label="Playback position"></progress>
      <div id="timeDisplay" class="text-center text-sm mt-1">0:00 / 0:00</div>
      <audio id="audio"></audio>
    </div>
  </div>

  <script>
    /* =========================================================
      Load catalog.json generated by build script.
      The file should be available next to index.html
      (copy build/catalog.json there during deploy)
    ========================================================= */
    let config = { playerName: 'No Label Player' };
    let albums = [];
    let playlists = [];
    let artists = [];

    fetch('config.json')
      .then(r => (r.ok ? r.json() : {}))
      .then(data => {
        config = { ...config, ...data };
        document.title = config.playerName;
        document.getElementById('playerName').textContent = config.playerName;
      })
      .catch(() => {});

    fetch('catalog.json')
      .then(r => {
        if (!r.ok) throw new Error('catalog.json not found');
        return r.json();
      })
      .then(data => {
        albums = data.albums || [];
        playlists = data.playlists || [];
        artists = data.artists || [];
        boot();
      })
      .catch(err => {
        console.error(err);
        // graceful fallback – empty lists, show message
        document.getElementById('albumList').innerHTML = '<li class="px-2 py-2 text-red-600">catalog.json missing</li>';
      });

    /* =========================================================
       DOM refs
    ========================================================= */
    const albumListEl = document.getElementById("albumList");
    const artistListEl = document.getElementById("artistList");
    const playlistListEl = document.getElementById("playlistList");
    const navBtns = document.querySelectorAll('#browseNav button');
    const trackListEl = document.getElementById("trackList");
    const audioEl = document.getElementById("audio");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const seekBar = document.getElementById("seekBar");
    const coverImg = document.getElementById("coverImg");
    const nowPlayingEl = document.getElementById("nowPlaying");
    const timeDisplay = document.getElementById("timeDisplay");

    const iconPlay = `
      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd"
          d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712"
          d="1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z"
          clip-rule="evenodd"/>
      </svg>`;
    const iconPause = `
      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd"
          d="M6.75 5.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H7.5a.75.75 0 0 1-.75-.75V5.25Z"
          d="M14.25 5.25A.75.75 0 0 1 15 4.5h1.5a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H15a.75.75 0 0 1-.75-.75V5.25Z"
          clip-rule="evenodd"/>
      </svg>`;
    const iconNext = `
      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path
          d="M5.055 7.06C3.805 6.347 2.25 7.25 2.25 8.69v8.122c0 1.44 1.555 2.343"
          d="2.805 1.628L12 14.471v2.34c0 1.44 1.555 2.343 2.805 1.628l7.108-4.061"
          d="c1.26-.72 1.26-2.536 0-3.256l-7.108-4.061C13.555 6.346 12 7.249 12 8.689"
          d="v2.34L5.055 7.061Z"/>
      </svg>`;
    const iconPrev = `
      <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path
          d="M9.195 18.44c1.25.714 2.805-.189 2.805-1.629v-2.34l6.945 3.968c1.25"
          d=".715 2.805-.188 2.805-1.628V8.69c0-1.44-1.555-2.343-2.805-1.628L12 11.029"
          d="v-2.34c0-1.44-1.555-2.343-2.805-1.628l-7.108 4.061c-1.26.72-1.26 2.536"
          d="0 3.256l7.108 4.061Z"/>
      </svg>`;

    /* =========================================================
       State
    ========================================================= */
    let currentList = [];
    let currentIndex = 0;
    let isPlaying = false;

    navBtns.forEach(btn => {
      btn.onclick = () => {
        navBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.target;
        albumListEl.classList.toggle('hidden', target !== 'albums');
        artistListEl.classList.toggle('hidden', target !== 'artists');
        playlistListEl.classList.toggle('hidden', target !== 'playlists');
      };
    });

    /* =========================================================
       Render helpers
    ========================================================= */
    function renderAlbums() {
      albumListEl.innerHTML = '';
      albums.forEach((album, idx) => {
        const li = document.createElement("li");
        li.textContent = album.title;
        li.className = "px-2 py-2 cursor-pointer hover:bg-black/5";
        li.onclick = () => loadAlbum(idx);
        albumListEl.appendChild(li);
      });
    }

    function renderArtists() {
      artistListEl.innerHTML = '';
      artists.forEach((artist, idx) => {
        const li = document.createElement('li');
        li.textContent = artist.name;
        li.className = 'px-2 py-2 cursor-pointer hover:bg-black/5';
        li.onclick = () => loadArtist(idx);
        artistListEl.appendChild(li);
      });
    }

    function renderPlaylists() {
      playlistListEl.innerHTML = '';
      playlists.forEach((pl, idx) => {
        const li = document.createElement("li");
        li.textContent = pl.title;
        li.className = "px-2 py-2 cursor-pointer hover:bg-black/5";
        li.onclick = () => loadPlaylist(idx);
        playlistListEl.appendChild(li);
      });
    }

    function loadAlbum(i) {
      currentList = albums[i].tracks;
      highlight(albumListEl, i);
      highlight(artistListEl, -1);
      highlight(playlistListEl, -1);
      if (albums[i].cover) {
        coverImg.src = albums[i].cover;
        coverImg.classList.remove('hidden');
      } else {
        coverImg.classList.add('hidden');
      }
      trackListEl.scrollTop = 0;
      renderTrackList();
      loadTrack(0);
    }

    function loadArtist(i) {
      currentList = artists[i].tracks;
      highlight(artistListEl, i);
      highlight(albumListEl, -1);
      highlight(playlistListEl, -1);
      coverImg.classList.add('hidden');
      trackListEl.scrollTop = 0;
      renderTrackList();
      loadTrack(0);
    }

    function loadPlaylist(i) {
      currentList = playlists[i].tracks;
      highlight(playlistListEl, i);
      highlight(albumListEl, -1);
      highlight(artistListEl, -1);
      coverImg.classList.add('hidden');
      trackListEl.scrollTop = 0;
      renderTrackList();
      loadTrack(0);
    }

    function renderTrackList() {
      trackListEl.innerHTML = "";
      currentList.forEach((t, idx) => {
        const li = document.createElement("li");
        li.textContent = `${t.title} – ${t.artist}`;
        li.className = "px-2 py-2 cursor-pointer hover:bg-black/5";
        li.onclick = () => loadTrack(idx);
        trackListEl.appendChild(li);
      });
    }

    function loadTrack(i) {
      currentIndex = i;
      const track = currentList[i];
      if (!track) return;
      audioEl.src = track.src;
      highlight(trackListEl, i);
      nowPlayingEl.textContent = `${track.title} – ${track.artist} (${track.album})`;
      if (isPlaying) audioEl.play();
      updateTime();
    }

    function highlight(listEl, idx) {
      Array.from(listEl.children).forEach((li, i) => {
        li.classList.toggle("active", i === idx);
      });
    }

    function formatTime(t) {
      if (!isFinite(t)) return '0:00';
      const m = Math.floor(t / 60);
      const s = Math.floor(t % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function updateTime() {
      timeDisplay.textContent = `${formatTime(audioEl.currentTime)} / ${formatTime(audioEl.duration)}`;
      seekBar.value = (audioEl.currentTime / audioEl.duration) * 100 || 0;
    }

    /* =========================================================
       Controls
    ========================================================= */
    playPauseBtn.onclick = () => {
      if (!audioEl.src) return;
      isPlaying ? audioEl.pause() : audioEl.play();
    };
    prevBtn.onclick = () => currentIndex > 0 && loadTrack(currentIndex - 1);
    nextBtn.onclick = () => currentIndex < currentList.length - 1 && loadTrack(currentIndex + 1);

    audioEl.onplay = () => { isPlaying = true; playPauseBtn.innerHTML = iconPause; };
    audioEl.onpause = () => { isPlaying = false; playPauseBtn.innerHTML = iconPlay; };
    audioEl.ontimeupdate = updateTime;
    audioEl.onloadedmetadata = updateTime;
    audioEl.onended = () => nextBtn.click();

    seekBar.onclick = (e) => {
      const rect = seekBar.getBoundingClientRect();
      audioEl.currentTime = ((e.clientX - rect.left) / rect.width) * audioEl.duration;
    };

    /* =========================================================
       Boot – called after catalog loads
    ========================================================= */
    function boot() {
      prevBtn.innerHTML = iconPrev;
      nextBtn.innerHTML = iconNext;
      playPauseBtn.innerHTML = iconPlay;
      updateTime();
      renderArtists();
      renderAlbums();
      renderPlaylists();
      if (albums.length) loadAlbum(0);
    }
  </script>
</body>
</html>
